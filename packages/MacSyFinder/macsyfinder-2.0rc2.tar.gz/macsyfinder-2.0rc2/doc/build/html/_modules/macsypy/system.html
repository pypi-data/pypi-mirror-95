

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>macsypy.system &mdash; MacSyFinder 2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> MacSyFinder
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modeler_guide/index.html">Modeller Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MacSyFinder</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>macsypy.system</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for macsypy.system</h1><div class="highlight"><pre>
<span></span><span class="c1">#########################################################################</span>
<span class="c1"># MacSyFinder - Detection of macromolecular systems in protein dataset  #</span>
<span class="c1">#               using systems modelling and similarity search.          #</span>
<span class="c1"># Authors: Sophie Abby, Bertrand Neron                                  #</span>
<span class="c1"># Copyright (c) 2014-2021  Institut Pasteur (Paris) and CNRS.           #</span>
<span class="c1"># See the COPYRIGHT file for details                                    #</span>
<span class="c1">#                                                                       #</span>
<span class="c1"># This file is part of MacSyFinder package.                             #</span>
<span class="c1">#                                                                       #</span>
<span class="c1"># MacSyFinder is free software: you can redistribute it and/or modify   #</span>
<span class="c1"># it under the terms of the GNU General Public License as published by  #</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or     #</span>
<span class="c1"># (at your option) any later version.                                   #</span>
<span class="c1">#                                                                       #</span>
<span class="c1"># MacSyFinder is distributed in the hope that it will be useful,        #</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of        #</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the          #</span>
<span class="c1"># GNU General Public License for more details .                         #</span>
<span class="c1">#                                                                       #</span>
<span class="c1"># You should have received a copy of the GNU General Public License     #</span>
<span class="c1"># along with MacSyFinder (COPYING).                                     #</span>
<span class="c1"># If not, see &lt;https://www.gnu.org/licenses/&gt;.                          #</span>
<span class="c1">#########################################################################</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">from</span><span class="o">.</span><span class="n">gene</span> <span class="kn">import</span> <span class="nn">GeneStatus</span>
<span class="kn">from</span> <span class="nn">.cluster</span> <span class="kn">import</span> <span class="n">Cluster</span>
<span class="kn">from</span> <span class="nn">.hit</span> <span class="kn">import</span> <span class="n">ValidHit</span>
<span class="kn">from</span> <span class="nn">.error</span> <span class="kn">import</span> <span class="n">MacsypyError</span>


<div class="viewcode-block" id="MatchMaker"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MatchMaker">[docs]</a><span class="k">class</span> <span class="nc">MatchMaker</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is an abstract class for (Odered/Unordered)MatchMaker</span>
<span class="sd">    the `match` class method must be implemented in concrete classes</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MatchMaker.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MatchMaker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="c1"># init my structures to count gene occurrences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mandatory_counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">mandatory_genes</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_mandatory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_exchangeable_map</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">mandatory_genes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">accessory_counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">accessory_genes</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_accessory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_exchangeable_map</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">accessory_genes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forbidden_counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">forbidden_genes</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_forbidden</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_exchangeable_map</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">forbidden_genes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">neutral_counter</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">neutral_genes</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_neutral</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_exchangeable_map</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">neutral_genes</span><span class="p">)</span></div>


<div class="viewcode-block" id="MatchMaker._create_exchangeable_map"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MatchMaker._create_exchangeable_map">[docs]</a>    <span class="k">def</span> <span class="nf">_create_exchangeable_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create a map between an exchangeable (formly homolog or analog) gene name and it&#39;s gene reference</span>

<span class="sd">        :param genes: The genes to get the exchangeable genes</span>
<span class="sd">        :type genes: list of :class:`macsypy.gene.ModelGene` objects</span>
<span class="sd">        :rtype: a dict with keys are the exchangeable gene_name and the value the reference gene name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ex_gene</span> <span class="ow">in</span> <span class="n">gene</span><span class="o">.</span><span class="n">exchangeables</span><span class="p">:</span>
                <span class="nb">map</span><span class="p">[</span><span class="n">ex_gene</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gene</span>
        <span class="k">return</span> <span class="nb">map</span></div>


<div class="viewcode-block" id="MatchMaker.sort_hits_by_status"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MatchMaker.sort_hits_by_status">[docs]</a>    <span class="k">def</span> <span class="nf">sort_hits_by_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sort :class:`macsypy.hit.Hit` according the</span>
<span class="sd">        the status of the gene the hit code for.</span>

<span class="sd">        :param hits: list of :class:`macsypy.hit.Hit` object</span>
<span class="sd">        :return: the valid hits according their status</span>
<span class="sd">        :rtype: a tuple of 4 lists</span>

<span class="sd">              * :class:`macsypy.hit.ValidHit` for MANDATORY genes</span>
<span class="sd">              * :class:`macsypy.hit.ValidHit` for ACCESSORY genes</span>
<span class="sd">              * :class:`macsypy.hit.ValidHit` for NEUTRAL genes</span>
<span class="sd">              * :class:`macsypy.hit.ValidHit` for FORBIDDEN genes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mandatory_hits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">accessory_hits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">neutral_hits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">forbidden_hits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">:</span>
            <span class="n">gene_name</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># the ValidHit need to be linked to the</span>
            <span class="c1"># gene of the model</span>
            <span class="n">gene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">get_gene</span><span class="p">(</span><span class="n">gene_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mandatory_counter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mandatory_counter</span><span class="p">[</span><span class="n">hit</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">mandatory_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_mandatory</span><span class="p">:</span>
                <span class="n">gene_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_mandatory</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mandatory_counter</span><span class="p">[</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">mandatory_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accessory_counter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accessory_counter</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">accessory_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">ACCESSORY</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_accessory</span><span class="p">:</span>
                <span class="n">gene_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_accessory</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accessory_counter</span><span class="p">[</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">accessory_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">ACCESSORY</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutral_counter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">neutral_counter</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">neutral_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">NEUTRAL</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_neutral</span><span class="p">:</span>
                <span class="n">gene_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_neutral</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">neutral_counter</span><span class="p">[</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">neutral_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">NEUTRAL</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forbidden_counter</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">forbidden_counter</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">forbidden_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">FORBIDDEN</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_forbidden</span><span class="p">:</span>
                <span class="n">gene_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchangeable_forbidden</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">forbidden_counter</span><span class="p">[</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">forbidden_hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValidHit</span><span class="p">(</span><span class="n">hit</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">GeneStatus</span><span class="o">.</span><span class="n">FORBIDDEN</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span></div>


<div class="viewcode-block" id="MatchMaker.present_genes"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MatchMaker.present_genes">[docs]</a>    <span class="k">def</span> <span class="nf">present_genes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the lists of genes name in model which are present replicon (included exchangeable)</span>
<span class="sd">        :rtype: tuple of 4 lists for mandatory, accessory, neutral and forbidden</span>
<span class="sd">                ([str gene_name, ...], [str gene_name], [str gene_name], [str gene_name])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mandatory_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_name</span> <span class="k">for</span> <span class="n">g_name</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mandatory_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">occ</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">accessory_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_name</span> <span class="k">for</span> <span class="n">g_name</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accessory_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">occ</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">neutral_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_name</span> <span class="k">for</span> <span class="n">g_name</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neutral_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">occ</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">forbidden_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_name</span> <span class="k">for</span> <span class="n">g_name</span><span class="p">,</span> <span class="n">occ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forbidden_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">occ</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mandatory_genes</span><span class="p">,</span> <span class="n">accessory_genes</span><span class="p">,</span> <span class="n">neutral_genes</span><span class="p">,</span> <span class="n">forbidden_genes</span></div>


    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="OrderedMatchMaker"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.OrderedMatchMaker">[docs]</a><span class="k">class</span> <span class="nc">OrderedMatchMaker</span><span class="p">(</span><span class="n">MatchMaker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    check if a set of hits match the quorum for ordered replicons (ordered_replicon or gembase)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="OrderedMatchMaker.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.OrderedMatchMaker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">redundancy_penalty</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_redundancy_penalty</span> <span class="o">=</span> <span class="n">redundancy_penalty</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></div>


<div class="viewcode-block" id="OrderedMatchMaker.match"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.OrderedMatchMaker.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clusters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check a set of clusters fill model constraints.</span>
<span class="sd">        If yes create a :class:`macsypy.system.System` otherwise create</span>
<span class="sd">        a :class:`macsypy.cluster.RejectedClusters`.</span>

<span class="sd">        :param clusters: The list of cluster to check if fit the model</span>
<span class="sd">        :type clusters: list of :class:`macsypy.cluster.Cluster` objects</span>
<span class="sd">        :return: either a System or a RejectedClusters</span>
<span class="sd">        :rtype: :class:`macsypy.system.System` or :class:`macsypy.cluster.RejectedClusters` object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># count the hits</span>
        <span class="c1"># and track for each hit for which gene it counts for</span>
        <span class="n">valid_clusters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">forbidden_hits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
            <span class="c1"># sort hits between forbidden and the other</span>
            <span class="c1"># and transform hit in ValidHit</span>
            <span class="o">*</span><span class="n">one_clst_allowed_hits</span><span class="p">,</span> <span class="n">one_clst_forbidden_hits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_hits_by_status</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">hits</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">one_clst_forbidden_hits</span><span class="p">:</span>
                <span class="n">forbidden_hits</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">one_clst_forbidden_hits</span><span class="p">)</span>
            <span class="c1"># create cluster of ValidHit</span>
            <span class="n">one_clst_allowed_hits</span> <span class="o">=</span> <span class="p">[</span><span class="n">vh</span> <span class="k">for</span> <span class="n">st_hits</span> <span class="ow">in</span> <span class="n">one_clst_allowed_hits</span> <span class="k">for</span> <span class="n">vh</span> <span class="ow">in</span> <span class="n">st_hits</span><span class="p">]</span>
            <span class="n">one_clst_allowed_hits</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">))</span>
            <span class="n">valid_clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Cluster</span><span class="p">(</span><span class="n">one_clst_allowed_hits</span> <span class="o">+</span> <span class="n">one_clst_forbidden_hits</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">_hit_weights</span><span class="p">))</span>

        <span class="n">mandatory_genes</span><span class="p">,</span> <span class="n">accessory_genes</span><span class="p">,</span> <span class="n">neutral_genes</span><span class="p">,</span> <span class="n">forbidden_genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">present_genes</span><span class="p">()</span>
        <span class="c1"># the count is finished</span>
        <span class="c1"># check if the quorum is reached</span>
        <span class="c1"># count how many different genes are represented in the clusters</span>
        <span class="c1"># the neutral genes belong to the cluster</span>
        <span class="c1"># but they do not count for the quorum</span>

        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mandatory_genes: </span><span class="si">{</span><span class="n">mandatory_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;accessory_genes: </span><span class="si">{</span><span class="n">accessory_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neutral_genes: </span><span class="si">{</span><span class="n">neutral_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;forbidden_genes: </span><span class="si">{</span><span class="n">forbidden_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">reasons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">is_a_system</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">forbidden_genes</span><span class="p">:</span>
            <span class="n">is_a_system</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">forbidden_hits</span><span class="p">)</span><span class="si">}</span><span class="s2"> forbidden genes occurrence(s):&quot;</span> \
                  <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">forbidden_hits</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_mandatory_genes_required</span><span class="p">:</span>
            <span class="n">is_a_system</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;The quorum of mandatory genes required (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_mandatory_genes_required</span><span class="si">}</span><span class="s1">) is not reached: &#39;</span> \
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">accessory_genes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_genes_required</span><span class="p">:</span>
            <span class="n">is_a_system</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;The quorum of genes required (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_genes_required</span><span class="si">}</span><span class="s1">) is not reached:&#39;</span> \
                  <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">accessory_genes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_a_system</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">valid_clusters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redundancy_penalty</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;is a system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">RejectedClusters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">valid_clusters</span><span class="p">,</span> <span class="n">reasons</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div></div>


<div class="viewcode-block" id="UnorderedMatchMaker"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.UnorderedMatchMaker">[docs]</a><span class="k">class</span> <span class="nc">UnorderedMatchMaker</span><span class="p">(</span><span class="n">MatchMaker</span><span class="p">):</span>

<div class="viewcode-block" id="UnorderedMatchMaker.match"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.UnorderedMatchMaker.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param hits:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># count the hits</span>
        <span class="c1"># and track for each hit for which gene it counts for</span>
        <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_hits_by_status</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span>
        <span class="c1"># the count is finished</span>
        <span class="c1"># check if the quorum is reached</span>
        <span class="c1"># count how many different genes are represented in the clusters</span>
        <span class="c1"># the neutral genes belong to the cluster</span>
        <span class="c1"># but they do not count for the quorum</span>
        <span class="n">mandatory_genes</span><span class="p">,</span> <span class="n">accessory_genes</span><span class="p">,</span> <span class="n">neutral_genes</span><span class="p">,</span> <span class="n">forbidden_genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">present_genes</span><span class="p">()</span>

        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mandatory_genes: </span><span class="si">{</span><span class="n">mandatory_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;accessory_genes: </span><span class="si">{</span><span class="n">accessory_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;neutral_genes: </span><span class="si">{</span><span class="n">neutral_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;forbidden_genes: </span><span class="si">{</span><span class="n">forbidden_genes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">is_a_potential_system</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">reasons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">forbidden_genes</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">forbidden_hits</span><span class="p">)</span><span class="si">}</span><span class="s2"> forbidden genes occurrence(s):&quot;</span> \
                  <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">forbidden_hits</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_mandatory_genes_required</span><span class="p">:</span>
            <span class="n">is_a_potential_system</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;The quorum of mandatory genes required (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_mandatory_genes_required</span><span class="si">}</span><span class="s1">) is not reached: &#39;</span> \
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">accessory_genes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_genes_required</span><span class="p">:</span>
            <span class="n">is_a_potential_system</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;The quorum of genes required (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">min_genes_required</span><span class="si">}</span><span class="s1">) is not reached:&#39;</span> \
                  <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">accessory_genes</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mandatory_genes</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">reasons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_a_potential_system</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">LikelySystem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There is a genetic potential for a system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">UnlikelySystem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span><span class="p">,</span> <span class="n">reasons</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div></div>


<div class="viewcode-block" id="HitSystemTracker"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.HitSystemTracker">[docs]</a><span class="k">class</span> <span class="nc">HitSystemTracker</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    track in which system is implied each hit</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HitSystemTracker.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.HitSystemTracker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">systems</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HitSystemTracker</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">systems</span><span class="p">:</span>
            <span class="n">v_hits</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">hits</span>
            <span class="k">for</span> <span class="n">v_hit</span> <span class="ow">in</span> <span class="n">v_hits</span><span class="p">:</span>
                <span class="n">hit</span> <span class="o">=</span> <span class="n">v_hit</span><span class="o">.</span><span class="n">hit</span>
                <span class="k">if</span> <span class="n">hit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">hit</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">hit</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">system</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ClusterSystemTracker"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.ClusterSystemTracker">[docs]</a><span class="k">class</span> <span class="nc">ClusterSystemTracker</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    track in which system is implied each cluster</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ClusterSystemTracker.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.ClusterSystemTracker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">systems</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ClusterSystemTracker</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">systems</span><span class="p">:</span>
            <span class="n">clusters</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">clusters</span>
            <span class="k">for</span> <span class="n">clst</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">clst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">clst</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">clst</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">system</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MetaSetOfHits"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MetaSetOfHits">[docs]</a><span class="k">class</span> <span class="nc">MetaSetOfHits</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This metaclass control the AbstractSetOfHits class creation.</span>
<span class="sd">    In this metaclass we inject on the fly several attributes and properties</span>
<span class="sd">    two private attributes and one public property corresponding to each value</span>
<span class="sd">    of _supported_status class attribute defined in the concrete classes.</span>
<span class="sd">    for instance for System class</span>

<span class="sd">     * the attributes</span>
<span class="sd">        * self._mandatory</span>
<span class="sd">        * self._mandatory_occ</span>
<span class="sd">        * self._accessory</span>
<span class="sd">        * self._accessory_occ</span>
<span class="sd">        * self._neutral</span>
<span class="sd">        * self._neutral_occ</span>
<span class="sd">     * and the properties</span>
<span class="sd">        * mandatory</span>
<span class="sd">        * accessory</span>
<span class="sd">        * neutral</span>

<span class="sd">    are automatically injected</span>

<span class="sd">    The value for attributes `_&lt;status&gt;_occ` are filled by the `count` method</span>
<span class="sd">    which is defined in AbstractSetOfHits</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetaSetOfHits.getter_maker"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MetaSetOfHits.getter_maker">[docs]</a>    <span class="k">def</span> <span class="nf">getter_maker</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a property which allow to access to the gene corresponding of the cat of the model</span>

<span class="sd">        :param str cat: the type of gene category to which we create the getter</span>
<span class="sd">        :return: unbound method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">getter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">occ</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">_occ&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">occ</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">getter</span></div>

<div class="viewcode-block" id="MetaSetOfHits.__call__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.MetaSetOfHits.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">new_system_inst</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># print()</span>
        <span class="c1"># print(&quot;##################### MetaSystem __call__ #################&quot;)</span>
        <span class="c1"># print(&quot;### new_system_inst&quot;, new_system_inst)</span>
        <span class="c1"># print(&quot;### new_system_inst._supported_status&quot;, new_system_inst._supported_status)</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">new_system_inst</span><span class="o">.</span><span class="n">_supported_status</span><span class="p">]:</span>
            <span class="c1"># set the private attribute in the Model instance</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new_system_inst</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">_occ&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="c1"># set the public property in the Model class</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">_occ&quot;</span><span class="p">,</span> <span class="nb">property</span><span class="p">(</span><span class="n">MetaSetOfHits</span><span class="o">.</span><span class="n">getter_maker</span><span class="p">(</span><span class="n">status</span><span class="p">)))</span>
        <span class="c1"># count fill _mandatory_occ, accessory_occ, ... attributes</span>
        <span class="n">new_system_inst</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">new_system_inst</span></div></div>


<div class="viewcode-block" id="AbstractSetOfHits"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.AbstractSetOfHits">[docs]</a><span class="k">class</span> <span class="nc">AbstractSetOfHits</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">MetaSetOfHits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Is the mother class of  System, RejectedCluster, LikelySystems UnlikelySystem, ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_id</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="AbstractSetOfHits.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.AbstractSetOfHits.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">replicon_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">replicon_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span></div>

    <span class="k">def</span> <span class="nf">_sort_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hits</span><span class="p">):</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">hits</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">hits</span>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">replicon_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The name of the replicon</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The position of the first and last hit,</span>
<span class="sd">                 excluded the hit coding for loners.</span>
<span class="sd">                 If the system is composed only by loners, used loners to compute position</span>
<span class="sd">        :rtype: tuple (start: int, end:int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># hits are sorted by their positions</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="o">.</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">loner</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hits</span><span class="p">:</span>
            <span class="n">hits</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">hits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># there are only loners</span>
            <span class="c1"># take them</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
        <span class="k">return</span> <span class="n">pos</span>


<div class="viewcode-block" id="AbstractSetOfHits.count"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.AbstractSetOfHits.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fill structures one for supported status mandatory, accessory, ...</span>
<span class="sd">        each structure count how many hit for each gene of the model</span>
<span class="sd">        mandatory_occ = { gene_name : [ValidHit, ...]</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supported_status</span><span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">_occ&quot;</span><span class="p">,</span>
                    <span class="p">{</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">_genes&quot;</span><span class="p">)}</span>
                    <span class="p">)</span>
        <span class="c1"># all the hits are ValidHit</span>
        <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">hit</span><span class="o">.</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">alternate_of</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
            <span class="n">status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hit</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>  <span class="c1"># transform gene status in lower string</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">_occ&quot;</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MacsypyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gene &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not belong to &#39;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39; genes in model &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wholeness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: a score indicating the genes ratio of the model which have at least one hit</span>
<span class="sd">                 by default full system is mandatory + accessory (&#39;neutral&#39; genes do not count)</span>
<span class="sd">                 but for special corner case it can be sepcified in model definition (xml)</span>
<span class="sd">                 or on the command line</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># model completude</span>
        <span class="c1"># the neutral hit do not participate to the model completude</span>
        <span class="n">score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">hits</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_occ</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessory_occ</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">hits</span><span class="p">])</span> <span class="o">/</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">max_nb_genes</span>
        <span class="k">return</span> <span class="n">score</span></div>


<div class="viewcode-block" id="System"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.System">[docs]</a><span class="k">class</span> <span class="nc">System</span><span class="p">(</span><span class="n">AbstractSetOfHits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Modelize as system. a system is an occurrence of a given model on a replicon.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_supported_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">GeneStatus</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">ACCESSORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">NEUTRAL</span><span class="p">)</span>

<div class="viewcode-block" id="System.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.System.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">redundancy_penalty</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param model:  The model which has ben used to build this system</span>
<span class="sd">        :type model: :class:`macsypy.model.Model` object</span>
<span class="sd">        :param clusters: The list of cluster that form this system</span>
<span class="sd">        :type clusters: list of :class:`macsypy.cluster.Cluster` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replicon_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="n">clusters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redundancy_penalty</span> <span class="o">=</span> <span class="n">redundancy_penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: a score take in account</span>
<span class="sd">            * if a hit match for the gene or it is an exchangeable gene</span>
<span class="sd">            * if a hit is duplicated and already present in the system or the cluster</span>
<span class="sd">            * if a hit match for mandatory/accessory gene of the model</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The score of the system is called for each clique</span>
            <span class="c1"># So to avoid computation we cached it</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>

        <span class="k">def</span> <span class="nf">clst_func</span><span class="p">(</span><span class="n">clsts</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">            :param clsts: list of clusters</span>
<span class="sd">            :return: return the list of functions which are represented in these clusters.</span>
<span class="sd">            :rtype: set of str</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">func_in_clst</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">clst</span> <span class="ow">in</span> <span class="n">clsts</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v_hit</span> <span class="ow">in</span> <span class="n">clst</span><span class="o">.</span><span class="n">hits</span><span class="p">:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">v_hit</span><span class="o">.</span><span class="n">gene_ref</span><span class="o">.</span><span class="n">alternate_of</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">func_in_clst</span><span class="p">:</span>
                        <span class="n">func_in_clst</span><span class="p">[</span><span class="n">func</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clst</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">func_in_clst</span><span class="p">[</span><span class="n">func</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">clst</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">func_in_clst</span>

        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=================== score computation for system </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> ===================&quot;</span><span class="p">)</span>
        <span class="c1"># split clusters in 2</span>
        <span class="c1"># the clusters loners  multi systems</span>
        <span class="c1"># and the others (regular)</span>
        <span class="n">regular_clsts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">loner_multi_syst_clsts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">clst</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">clst</span><span class="o">.</span><span class="n">loner</span><span class="p">()</span> <span class="ow">and</span> <span class="n">clst</span><span class="o">.</span><span class="n">hits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">multi_system</span><span class="p">:</span>
                <span class="n">loner_multi_syst_clsts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clst</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">regular_clsts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clst</span><span class="p">)</span>

        <span class="c1"># Compute score of regular clusters</span>
        <span class="n">clst_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">clst</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">clst</span> <span class="ow">in</span> <span class="n">regular_clsts</span><span class="p">]</span>
        <span class="n">score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">clst_scores</span><span class="p">)</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;regular clusters scores sum(</span><span class="si">{</span><span class="n">clst_scores</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mandatory_genes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">accessory_genes</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;compute penalty redundancy&quot;</span><span class="p">)</span>
            <span class="c1"># it cannot be forbidden gene in System instance</span>
            <span class="c1"># the neutral genes do not play a role in score (only to build clusters)</span>
            <span class="n">clst_having_hit</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">clst</span> <span class="ow">in</span> <span class="n">regular_clsts</span> <span class="k">if</span> <span class="n">clst</span><span class="o">.</span><span class="n">fulfilled_function</span><span class="p">(</span><span class="n">gene</span><span class="p">)])</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nb of clusters which fulfill function of </span><span class="si">{</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">clst_having_hit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clst_having_hit</span><span class="p">:</span>
                <span class="n">clst_penalty</span> <span class="o">=</span> <span class="p">(</span><span class="n">clst_having_hit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">redundancy_penalty</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;clst_penalty </span><span class="si">{</span><span class="o">-</span> <span class="n">clst_penalty</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">score</span> <span class="o">-=</span> <span class="n">clst_penalty</span>

        <span class="c1"># compute score of loners multi systems</span>
        <span class="n">loners_multi_syst_functions</span> <span class="o">=</span> <span class="n">clst_func</span><span class="p">(</span><span class="n">loner_multi_syst_clsts</span><span class="p">)</span>
        <span class="n">regular_functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">clst_func</span><span class="p">(</span><span class="n">regular_clsts</span><span class="p">))</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;compute score of loner multi systems&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">funct</span> <span class="ow">in</span> <span class="n">loners_multi_syst_functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">funct</span> <span class="ow">in</span> <span class="n">regular_functions</span><span class="p">:</span>
                <span class="n">loners_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">loners_multi_syst_functions</span><span class="p">[</span><span class="n">funct</span><span class="p">])</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;score for </span><span class="si">{</span><span class="n">funct</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">loners_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="n">loners_score</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if the biological funct is already encoded by regular clusters</span>
                <span class="c1"># we do not increase the score</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">funct</span><span class="si">}</span><span class="s2"> is already in regular clusters&quot;</span><span class="p">)</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;score of system </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">score</span>


<div class="viewcode-block" id="System.occurrence"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.System.occurrence">[docs]</a>    <span class="k">def</span> <span class="nf">occurrence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sometimes several systems collocates so they form only one cluster</span>
<span class="sd">        so macsyfinder build only one system</span>
<span class="sd">        the occurrence is an indicator of how many systems are</span>
<span class="sd">        it&#39;s based on the number of occurrence of each mandatory genes</span>
<span class="sd">        The multi_system genes are not take in account.</span>

<span class="sd">        :return: a predict number of biologic systems</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">genes</span><span class="p">}</span>
        <span class="n">occ_per_gene</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="k">for</span> <span class="n">gene_name</span><span class="p">,</span> <span class="n">hits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_occ</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">genes</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span><span class="o">.</span><span class="n">multi_system</span><span class="p">]</span>
        <span class="c1"># if a systems contains 5 gene with occ of 1 and 5 gene with 0 occ</span>
        <span class="c1"># the median is 0.5</span>
        <span class="c1"># round(0.5) = 0</span>
        <span class="c1"># so I fix a floor value at 1</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">occ_per_gene</span><span class="p">)))</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of all hits that compose this system</span>
<span class="sd">        :rtype: [:class:`macsypy.hit.ValidHits` , ... ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_hits</span><span class="p">([</span><span class="n">h</span> <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">hits</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">hits</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The number of loci of this system (loners are not considered)</span>
<span class="sd">        :rtype: int &gt; 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we do not take loners in account</span>
        <span class="n">loci</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">loci</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">multi_loci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True if the systems is multi_loci. False otherwise</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loci</span> <span class="o">&gt;</span> <span class="mi">1</span>


<div class="viewcode-block" id="System.is_compatible"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.System.is_compatible">[docs]</a>    <span class="k">def</span> <span class="nf">is_compatible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param other: the other systems to test compatibility</span>
<span class="sd">        :type other: :class:`macsypy.system.System` object</span>
<span class="sd">        :return: True if other system is compatible with this one. False otherwise.</span>
<span class="sd">                 Two systems are compatible if they do not share :class:`macsypy.hit.Hit`</span>
<span class="sd">                 except hit corresponding to a multi_system gene in the model.</span>

<span class="sd">                 .. note::</span>
<span class="sd">                    This method is used to compute the best combination of systems.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_hits</span> <span class="o">=</span> <span class="p">{</span><span class="n">vh</span><span class="o">.</span><span class="n">hit</span> <span class="k">for</span> <span class="n">vh</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">hits</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">vh</span><span class="o">.</span><span class="n">multi_system</span><span class="p">}</span>
        <span class="n">my_hits</span> <span class="o">=</span> <span class="p">{</span><span class="n">vh</span><span class="o">.</span><span class="n">hit</span> <span class="k">for</span> <span class="n">vh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">vh</span><span class="o">.</span><span class="n">multi_system</span><span class="p">}</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">my_hits</span> <span class="o">&amp;</span> <span class="n">other_hits</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RejectedClusters"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.RejectedClusters">[docs]</a><span class="k">class</span> <span class="nc">RejectedClusters</span><span class="p">(</span><span class="n">AbstractSetOfHits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle a set of clusters which has been rejected during the :func:`macsypy.system.match`  step</span>
<span class="sd">    This clusters (can be one) does not fill the requirements or contains forbidden genes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_supported_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">GeneStatus</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">ACCESSORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">NEUTRAL</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">FORBIDDEN</span><span class="p">)</span>

<div class="viewcode-block" id="RejectedClusters.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.RejectedClusters.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">clusters</span><span class="p">,</span> <span class="n">reasons</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param model:</span>
<span class="sd">        :type model: :class:`macsypy.model.Model` object</span>
<span class="sd">        :param clusters: list of clusters. These Clusters should be created with</span>
<span class="sd">                         :class:`macsypy.cluster.Cluster` of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        :type clusters: list of :class:`macsypy.cluster.Cluster` objects</span>
<span class="sd">        :param reason: the reason why these clusters have been rejected</span>
<span class="sd">        :type reason: list of string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="n">Cluster</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="p">[</span><span class="n">clusters</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="o">=</span> <span class="n">clusters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replicon_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reasons</span> <span class="o">=</span> <span class="n">reasons</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reasons</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">reasons</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="RejectedClusters.__str__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.RejectedClusters.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: a string representation of this RejectedCluster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;These clusters have been rejected because:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reasons</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">- </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">s</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: The list of all hits that compose this system</span>
<span class="sd">        :rtype: [:class:`macsypy.hit.ValidHits` , ... ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_hits</span><span class="p">([</span><span class="n">h</span> <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">cluster</span><span class="o">.</span><span class="n">hits</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">hits</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reasons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reasons</span></div>


<div class="viewcode-block" id="AbstractUnordered"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.AbstractUnordered">[docs]</a><span class="k">class</span> <span class="nc">AbstractUnordered</span><span class="p">(</span><span class="n">AbstractSetOfHits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Technical abstract class to factorize code share between</span>
<span class="sd">    LikelySystem and UnlikelySystem</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AbstractUnordered.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.AbstractUnordered.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_hits</span> <span class="o">=</span> <span class="n">mandatory_hits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accessory_hits</span> <span class="o">=</span> <span class="n">accessory_hits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_neutral_hits</span> <span class="o">=</span> <span class="n">neutral_hits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forbidden_hits</span> <span class="o">=</span> <span class="n">forbidden_hits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_hits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replicon_name</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replicon_name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of all hits sorted by their position</span>
<span class="sd">        :rtype: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_hits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_hits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessory_hits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutral_hits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">forbidden_hits</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mandatory_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of mandatory hits</span>
<span class="sd">        :rtype: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_hits</span><span class="p">[:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">accessory_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of accesory hits</span>
<span class="sd">        :rtype: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessory_hits</span><span class="p">[:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">neutral_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of neutral hits</span>
<span class="sd">        :rtype: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutral_hits</span><span class="p">[:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">forbidden_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of forbidden hits</span>
<span class="sd">        :rtype: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forbidden_hits</span><span class="p">[:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allowed_hits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The list of allowed (mandatory, accessory, neutral) hits</span>
<span class="sd">        :rtype: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_hits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessory_hits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neutral_hits</span></div>


<div class="viewcode-block" id="LikelySystem"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.LikelySystem">[docs]</a><span class="k">class</span> <span class="nc">LikelySystem</span><span class="p">(</span><span class="n">AbstractUnordered</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">    Handle components that fill the quorum requirements defined in model.</span>
<span class="sd">    with no idea about genetic organization (gene cluster)</span>
<span class="sd">    so we cannot take in account forbidden genes</span>

<span class="sd">    .. note:</span>
<span class="sd">        do not forget that this class inherits from MetaSetOfHits</span>
<span class="sd">        so the getter to mandatory, accessory, neutral, forbidden is dynamically injected</span>
<span class="sd">        by the meta class base on  _supported_status</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_supported_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">GeneStatus</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">ACCESSORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">NEUTRAL</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">FORBIDDEN</span><span class="p">)</span>


<div class="viewcode-block" id="LikelySystem.__str__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.LikelySystem.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: a string representation of this LikelySystem</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">position</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="UnlikelySystem"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.UnlikelySystem">[docs]</a><span class="k">class</span> <span class="nc">UnlikelySystem</span><span class="p">(</span><span class="n">AbstractUnordered</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle components that not fill the quorum requirements defined in model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_supported_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">GeneStatus</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">ACCESSORY</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">NEUTRAL</span><span class="p">,</span>
                         <span class="n">GeneStatus</span><span class="o">.</span><span class="n">FORBIDDEN</span><span class="p">)</span>


<div class="viewcode-block" id="UnlikelySystem.__init__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.UnlikelySystem.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span><span class="p">,</span> <span class="n">reasons</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param model:  The model which has ben used to build this system</span>
<span class="sd">        :type model: :class:`macsypy.model.Model` object</span>
<span class="sd">        :param allowed_hits: The list of hits that form this potential system</span>
<span class="sd">                             this hits status must be MANDATORY, ACCESSORY or NEUTRAL</span>
<span class="sd">        :type allowed_hits: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        :param forbidden_hits: The list of hits that are forbidden</span>
<span class="sd">        :type forbidden_hits: list of :class:`macsypy.hit.ValidHit` objects</span>
<span class="sd">        :param reasons: the reasons why this set of hits has been rejected</span>
<span class="sd">        :type reasons: List of str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mandatory_hits</span><span class="p">,</span> <span class="n">accessory_hits</span><span class="p">,</span> <span class="n">neutral_hits</span><span class="p">,</span> <span class="n">forbidden_hits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reasons</span> <span class="o">=</span> <span class="n">reasons</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reasons</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">reasons</span><span class="p">]</span></div>


<div class="viewcode-block" id="UnlikelySystem.__str__"><a class="viewcode-back" href="../../developer_guide/api/system.html#macsypy.system.UnlikelySystem.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: a string representation of this UnlikelySystem</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">gene</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">h</span><span class="o">.</span><span class="n">position</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hits</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;: These hits does not probably constitute a system because:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reasons</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reasons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: The reasons why it probably not a system</span>
<span class="sd">        :rtype: list of string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reasons</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2021, &#39;Institut Pasteur (Paris), CNRS&#39;

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

<a href="https://github.com/gem-pasteur/macsyfinder">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
         src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
         alt="Fork me on GitHub"
         data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
</a>



</body>
</html>
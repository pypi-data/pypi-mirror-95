!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("jquery"),require("base/js/utils"),require("base/js/namespace"),require("base/js/events"),require("services/config"),require("require"),require("moment"),require("base/js/dialog"),require("base/js/keyboard"));else if("function"==typeof define&&define.amd)define(["jquery","base/js/utils","base/js/namespace","base/js/events","services/config","require","moment","base/js/dialog","base/js/keyboard"],t);else{var n="object"==typeof exports?t(require("jquery"),require("base/js/utils"),require("base/js/namespace"),require("base/js/events"),require("services/config"),require("require"),require("moment"),require("base/js/dialog"),require("base/js/keyboard")):t(e.jquery,e["base/js/utils"],e["base/js/namespace"],e["base/js/events"],e["services/config"],e.require,e.moment,e["base/js/dialog"],e["base/js/keyboard"]);for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}("undefined"!=typeof self?self:this,function(e,t,n,o,a,s,i,r,c){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t){e.exports=a},function(e,t,n){"use strict";function o(e){return c()("<div/>").addClass("alert alert-dismissable").addClass(e).append(c()('<button class="close" type="button" data-dismiss="alert" aria-label="Close"/>').append(c()('<span aria-hidden="true"/>').html("&times;")))}function a(e,t){null!=e&&(e.data("bs.modal").isShown=!0,e.modal("hide"));var n=o("alert-danger").hide().append(c()("<p/>").text(t)),a=c()("<div/>").attr("id","share-notification").append(n);c()("body").prepend(a),n.slideDown("fast"),c()("#share-notification").fadeTo(4e3,500).slideUp(500,function(){c()("#share-notification").slideUp(500)})}function s(e,t){var n=o("alert-danger").hide().append(c()("<p/>").text(t));e.find(".modal-body").prepend(n),n.slideDown("fast"),e.find(".btn").prop("disabled",!1),e.data("bs.modal").isShown=!0,n.fadeTo(4e3,500).slideUp(500,function(){n.slideUp(500)})}function i(e,t){var n=c()("<p>").addClass("success").append('<i class="icon-checked">').append(t);e.find(".modal-body").html(n),e.find(".modal-footer").empty(),null!=e&&setTimeout(function(){e.data("bs.modal").isShown=!0,e.modal("hide")},850)}var r=n(0),c=n.n(r);t.a={alert_error:a,alert_error_modal:s,alert_success:i}},function(e,t){e.exports=s},function(e,t,n){"use strict";function o(){return h}function a(e){this.name="TokenError",this.message=e||""}function s(e,t,n,o){d(h.domain+h.base+h.shared,e,"GET",null,"json",n,o)}function i(e,t,n,o){d(h.domain+h.base+h.shared_with_me,e,"GET",null,"json",n,o)}function r(e,t,n,o){d(h.domain+h.base+h.share,e,"GET",{project:t},"json",n,o)}function c(e,t,n,o){d(h.domain+h.base+h.share+"?project="+encodeURIComponent(t.project),e,"PUT",JSON.stringify({share_with:t.share}),null,n,o)}function l(e,t,n,o){d(h.domain+h.base+h.share+"?project="+encodeURIComponent(t),e,"DELETE",null,null,n,o)}function u(e,t,n,o){d(h.domain+h.base+h.clone+"?project="+encodeURIComponent(t.project)+"&sharer="+t.sharer+"&destination="+encodeURIComponent(t.destination),e,"POST",null,null,n,o)}function d(e,t,n,o,s,i,r){g.a.ajax({url:b.a.toUrl(e),headers:{Authorization:"Bearer "+t},type:n,data:o,dataType:s,statusCode:{401:function(){throw new a("Invalid token")}},success:i,error:r})}function p(e){return function(t,n,o){try{T.ready(e,t,n,o)}catch(s){if(s instanceof a)try{T.invalidate(),T.ready(e,t,n,o)}catch(e){o?o(_,s.message,e):console.error("SwanShare API error",e)}else o?o(_,s.message,s):console.error("SwanShare API error getting Token",s)}}}var h,f=n(0),g=n.n(f),m=n(6),b=n.n(m),v=n(1),y=n.n(v),w=n(4),x=n.n(w),j=n(15),C=n.n(j),S=y.a.get_body_data("baseUrl"),k=new Promise(function(e,t){var n=new x.a.ConfigSection("sharing",{base_url:S});n.load(),n.loaded.then(function(){n.data.sharing?(console.log("Found configurations for SwanShare",n.data.sharing),h=n.data.sharing,e()):(console.log("Using default configuration for SwanShare"),h=C.a,e())}).catch(function(){console.warn("Error getting SwanShare config: Using default"),h=C.a,e()})});a.prototype=Object.create(Error.prototype);var T={_token:-1,_get_auth_token:function(e,t,n,o){console.log("Getting CERNBox auth token");var a=this;g.a.get(S+"api/swanshare?origin="+window.location.origin).done(function(s){a._token=s,e(a._token.authtoken,t,n,o)}).fail(function(){o(_,"Error contacting CERNBox")})},ready:function(e,t,n,o){var a=this;k.then(function(){-1==a._token||new Date(a._token.expire)<new Date?a._get_auth_token(e,t,n,o):e(a._token.authtoken,t,n,o)})},invalidate:function(){this._token=-1},get_auth_token_value:function(){return this._token.authtoken}};t.a={get_shared_projects_by_me:p(s),get_shared_projects_with_me:p(i),get_shared_project_info:p(r),set_shared_project:p(c),remove_sharing_project:p(l),clone_shared_project:p(u),get_endpoints:o,authtoken:T}},function(e,t,n){"use strict";function o(){O.a.get_shared_projects_with_me({},function(e){j=e.shares&&e.shares.length>0?e.shares:null,i()}),O.a.get_shared_projects_by_me({},function(e){x=e.shares&&e.shares.length>0?e.shares:null,r()})}function a(){s(),"SWAN_projects"===T.a.notebook_list.notebook_path&&O.a.get_shared_projects_by_me({},function(e){var t=[];S.a.each(e.shares,function(e,n){t.push(n.project)}),x=t,s()})}function s(){S()("#notebook_list").find(".project_icon").each(function(){var e=S()(this).closest(".list_item"),t=e.find(".item_link").attr("href").replace(T.a.notebook_list.base_url+"cernbox/","").replace(T.a.notebook_list.base_url+"projects/","SWAN_projects/").replace(/%20/g," ").replace(/^\/|\/$/g,"");e.find(".sharing-button").remove();var n;n=-1!==S.a.inArray(t,x)?S()('<li><a href="javascript:" class="sharing-button blue">Edit sharing</a></li>'):S()('<li><a href="javascript:" class="sharing-button green">Share</a></li>'),n.click(function(){return H.a.show_share_modal(t),!1}),e.find(".actions").append(n),-1!==S.a.inArray(t,x)?e.find(".sharing-indicator").show():e.find(".sharing-indicator").hide()})}function i(){var e=S()("#shared-projects-list");if(e.html(""),j.sort(W.shared.function),j){var t=S()("#shared-projects-project-element");S.a.each(j,function(n,o){var a=t.clone();a.attr("id","");var s=o.project.split("/");s=s[s.length-1],a.find(".item_name").text(s),a.find(".shared_date").text(P.a.format_datetime(o.shared_with[0].created)),a.find(".shared_date").attr("title",U()(o.shared_with[0].created).format("YYYY-MM-DD HH:mm")),a.find(".shared_size").text(P.a.format_filesize(parseInt(o.size))),a.find(".shared_user").text(o.shared_by),a.find(".btn-clone").on("click",function(){y(o.project,o.shared_by)});var i=T.a.notebook_list.base_url+"share/"+o.shared_by+"/"+s;a.find(".item_link").attr("href",i),a.show(),e.append(a)})}else{var n=S()("#share-projects-placeholder").clone();n.show(),e.append(n)}}function r(){var e=S()("#sharing-projects-list");if(e.html(""),x){var t=S()("#sharing-projects-project-element");x.sort(W.sharing.function),S.a.each(x,function(n,o){var a=t.clone();a.attr("id",""),a.find(".item_name").text(o.project.replace("SWAN_projects/","")),a.find(".shared_date").text(P.a.format_datetime(o.shared_with[0].created)),a.find(".shared_date").attr("title",U()(o.shared_with[0].created).format("YYYY-MM-DD HH:mm")),1==o.shared_with.length?a.find(".shared_with").text(o.shared_with[0].name):a.find(".shared_with").text(o.shared_with.length+" people/groups"),a.find(".btn-update").on("click",function(){H.a.show_share_modal(o.project)});var s=T.a.notebook_list.base_url+"projects/"+o.project.replace("SWAN_projects/","");a.find(".item_link").attr("href",s),a.show(),e.append(a)})}else{var n=S()("#share-projects-placeholder").clone();n.show(),e.append(n)}}function c(){L.tree.load();var e;T.a.notebook_list.current_page===T.a.notebook_list.pages.share?(e=o,l()):e=a,e&&L.tree.loaded.then(function(){e(),N.a.on("draw_notebook_list.NotebookList",e)})}function l(){S()(".sort-action-share").unbind(),S()(".sort-action-share").click(function(e){var t=S()(e.target),n=e.target.dataset.sorter,o=t.closest(".notebook_list"),a=o.attr("id");o.find(".sort-action-share i").removeClass("fa-sort-desc").removeClass("fa-sort-asc"),W[a].id===n&&1===W[a].direction?(u(a,n,0),t.find("i").addClass("fa-sort-asc"),W[a].direction=0):(u(a,n,1),t.find("i").addClass("fa-sort-desc"),W[a].direction=1),W[a].id=n,o.find(".sort-action-share i").hide(),t.find("i").show()}),S()(".notebook_list.collapse ").on("shown.bs.collapse",function(){S()(this).parent().find("h1 i, h2 i").removeClass("icon-expand").addClass("icon-collapse")}),S()(".notebook_list.collapse ").on("hidden.bs.collapse",function(){S()(this).parent().find("h1 i, h2 i").removeClass("icon-collapse").addClass("icon-expand")})}function u(e,t,n){z.hasOwnProperty(t)?(W[e].function=z[t](n),W[e].draw()):console.error("No such sort id: '"+t+"'")}function d(){L.notebook.load(),L.notebook.loaded.then(function(){var e=S()('<button class="btn btn-default btn-xs" title="Share">             <i class="fa fa-share-alt" aria-hidden="true"></i>            </button>');e.on("click",function(){var e=window.location.href;-1!==e.indexOf(T.a.notebook.base_url+"notebooks/SWAN_projects/")?(e=e.replace("/notebooks/SWAN_projects/","/api/contents/SWAN_projects/").split(encodeURI(T.a.notebook.notebook_name))[0],S.a.get(e,function(e){"project"===e.type?H.a.show_share_modal(e.path):"directory"===e.type&&e.project?H.a.show_share_modal(e.project):V.a.alert_error(null,"You can only share SWAN Projects. Please place this notebook inside one.")}).fail(function(e){console.log("Error getting project path",e),V.a.alert_error(null,"There was an error with your project. Please try again later.")})):V.a.alert_error(null,"You can only share SWAN Projects and they must be inside SWAN_projects")}),S()("#buttons-right").prepend(e)})}function p(e){return function(t,n){return b(e,t.project,n.project)}}function h(e){return function(t,n){return b(e,t.shared_by,n.shared_by)}}function f(e){return function(t,n){return 1==t.shared_with.length&&1==n.shared_with.length?b(e,t.shared_with[0].name,n.shared_with[0].name):_(e,t.shared_with.length,n.shared_with.length)}}function g(e){return function(t,n){return _(e,parseInt(t.size),parseInt(n.size))}}function m(e){var t=e?1:0;return function(e,n){return P.a.datetime_sort_helper(e.shared_with[0].created,n.shared_with[0].created,t)}}function b(e,t,n){return t.toLowerCase()<n.toLowerCase()?e?-1:1:t.toLowerCase()>n.toLowerCase()?e?1:-1:0}function _(e,t,n){return t<n?e?-1:1:t>n?e?1:-1:0}function v(e){H.a.show_share_modal(e)}function y(e,t){H.a.show_clone_modal(e,t)}function w(){null!=T.a.notebook?d():c()}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"share_button_click",function(){return v}),n.d(t,"clone_project",function(){return y}),n.d(t,"load_ipython_extension",function(){return w});var x,j,C=n(0),S=n.n(C),k=n(2),T=n.n(k),I=n(3),N=n.n(I),E=n(1),P=n.n(E),R=n(4),q=n.n(R),A=n(9),U=n.n(A),V=n(5),H=n(10),O=n(7),B=P.a.get_body_data("baseUrl"),L={notebook:new q.a.ConfigSection("notebook",{base_url:B}),tree:new q.a.ConfigSection("tree",{base_url:B})},W={shared:{id:"sort-name",direction:1,function:p(1),draw:i},sharing:{id:"sort-name",direction:1,function:p(1),draw:r}},z={"sort-name":p,"last-modified":m,"sort-size":g,"sort-with":f,"sort-by":h}},function(e,t){e.exports=i},function(e,t,n){"use strict";function o(){return R.length>0&&(l.find(".btn").prop("disabled",!0),l.data("bs.modal").isShown=!1,P.a.set_shared_project({project:d,share:R},function(){E.a.alert_success(l,(A?"Started":"Updated")+" sharing with success"),y.a.trigger("draw_notebook_list.NotebookList")},function(){E.a.alert_error_modal(l,"Error trying to share the Project. Please try again.")})),!1}function a(){l.find(".btn").prop("disabled",!0),l.data("bs.modal").isShown=!1,P.a.remove_sharing_project(d,function(){E.a.alert_success(l,"Stopped sharing with success"),y.a.trigger("draw_notebook_list.NotebookList")},function(){E.a.alert_error_modal(l,"Error trying to stop sharing the Project. Please try again.")})}function s(){u.find(".btn").prop("disabled",!0),u.data("bs.modal").isShown=!1;var e=u.find("#new_name").val();P.a.clone_shared_project({project:d,sharer:p,destination:"SWAN_projects/"+e},function(){var t=x.a.get_body_data("baseUrl");window.location.replace(t+"projects/"+e)},function(e){var t=JSON.parse(e.responseText);E.a.alert_error_modal(u,"Error trying to clone the Project. Please try again. "+t.error)})}function i(e){q.push(e.name);var t=l.find("#shared-people"),n=f()("<li>").appendTo(t);n.append('<span class="remove">Ã—</span>'),"u"===e.entity?n.append('<i class="fa fa-user" aria-hidden="true"></i>'):n.append('<i class="fa fa-users" aria-hidden="true"></i>'),n.append(e.display_name?e.display_name:e.name),n.on("click",function(){R.splice(R.indexOf(e),1),q.splice(q.indexOf(e.name),1),n.remove(),0===R.length&&l.find(".act-update, .act-share").attr("disabled","")}),l.find(".act-update, .act-share").removeAttr("disabled")}function r(e){d=e,R=[],q=[],A=!0,P.a.get_shared_project_info(e,function(t){var n=t.shares[0]?t.shares[0].shared_with:null;l=C.a.modal({show:!1,draggable:!1,title:"Share Project",notebook:_.a.notebook,keyboard_manager:_.a.keyboard_manager,body:f()("<div/>").attr("id","share-widget").append(N.a),buttons:n?U.has_state:U.no_state}).attr("id","sharing-modal").addClass("right"),n?(R=n,R.forEach(i),A=!1):l.find(".act-share").attr("disabled",""),l.find("#name-search").devbridgeAutocomplete({serviceUrl:m.a.toUrl(P.a.get_endpoints().domain+P.a.get_endpoints().base+P.a.get_endpoints().search),showNoSuggestionNotice:!0,minChars:2,deferRequestBy:400,preventBadQueries:!1,preserveInput:!0,paramName:"filter",dataType:"json",ajaxSettings:{headers:{Authorization:"Bearer "+P.a.authtoken.get_auth_token_value()}},transformResult:function(e){return{suggestions:f.a.map(e,function(e){if(e.cn===p)return null;if("egroup"===e.account_type||"unixgroup"===e.account_type)return null;var t={name:e.cn,entity:"egroup"===e.account_type?"egroup":"unixgroup"===e.account_type?"g":"u",display_name:"egroup"===e.account_type?e.display_name:e.display_name+" ("+e.cn+")"};return{value:t.display_name,data:t}})}},onSelect:function(e){R.push(e.data),i(e.data),l.find("#name-search").val("")},onSearchStart:function(){f()(this).parent().find(".error").hide(),f()(this).parent().find(".loading").show()},onSearchComplete:function(){f()(this).parent().find("i").hide()},onSearchError:function(e,t,n,o){if(0!==t.status){var a=f()(this).parent().find(".error");400===t.status?(a.attr("title","Invalid input"),a.addClass("warning")):(a.attr("title","Error contacting directory. Please try again."),a.removeClass("warning"),console.log("Error contacting directory:",o)),f()(this).parent().find(".loading").hide(),a.show()}},beforeRender:function(e,t){if(0!==t.length){var n=0;f.a.each(t,function(t,o){-1!==q.indexOf(o.data.name)&&(e.find("[data-index="+t+"]").hide(),n++)}),n===t.length&&f()('<div class="autocomplete-no-suggestion">Name(s) already added</div>').appendTo(e)}}}),l.on("shown.bs.modal",function(){l.find("#name-search").focus()}),l.modal("show"),l.find(".modal-header").unbind("mousedown"),l.find(".project-path").text(e.replace("SWAN_projects/","").replace(/^\/|\/$/g,""))},function(e,t,n){console.log("Error opening the share dialog",e,t,n);var o=JSON.parse(e.responseText);E.a.alert_error(null,"Error opening the share dialog. "+o.error)})}function c(e,t){d=e,p=t;var n=e.split("/");u=C.a.modal({draggable:!1,title:"Clone Project",notebook:_.a.notebook,body:f()('<div><p class="rename-message">Enter the cloned Project name:</p><br><input id="new_name"  value="'+n[n.length-1]+'"type="text" size="25" class="form-control"></div>'),buttons:U.clone,open:function(){u.find('input[type="text"]').keydown(function(e){if(e.which===k.a.keycodes.enter)return u.find(".btn-primary").first().click(),!1}),u.find('input[type="text"]').focus().select()}})}var l,u,d,p,h=n(0),f=n.n(h),g=n(6),m=n.n(g),b=n(2),_=n.n(b),v=n(3),y=n.n(v),w=n(1),x=n.n(w),j=n(11),C=n.n(j),S=n(12),k=n.n(S),T=n(13),I=(n.n(T),n(14)),N=n.n(I),E=n(5),P=n(7),R=[],q=[],A=!0,p=(_.a.notebook_list?_.a.notebook_list:_.a.notebook).base_url.replace("/user/","").replace("/",""),U={has_state:{"Stop Sharing":{class:"btn-danger act-unshare size-50",click:a},Update:{class:"btn-primary act-update size-50",click:o}},no_state:{Share:{class:"btn-success act-share size-100",click:o}},clone:{Clone:{class:"btn-success act-share size-100",click:s}}};t.a={show_share_modal:r,show_clone_modal:c}},function(e,t){e.exports=r},function(e,t){e.exports=c},function(e,t,n){var o,a,s;!function(i){"use strict";a=[n(0)],o=i,void 0!==(s="function"==typeof o?o.apply(t,a):o)&&(e.exports=s)}(function(e){"use strict";function t(n,o){var a=this;a.element=n,a.el=e(n),a.suggestions=[],a.badQueries=[],a.selectedIndex=-1,a.currentValue=a.element.value,a.timeoutId=null,a.cachedResponse={},a.onChangeTimeout=null,a.onChange=null,a.isLocal=!1,a.suggestionsContainer=null,a.noSuggestionsContainer=null,a.options=e.extend(!0,{},t.defaults,o),a.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},a.hint=null,a.hintValue="",a.selection=null,a.initialize(),a.setOptions(o)}function n(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)}function o(t){return"string"==typeof t?e.parseJSON(t):t}function a(e,t){if(!t)return e.value;var n="("+i.escapeRegExChars(t)+")";return e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")}function s(e,t){return'<div class="autocomplete-group">'+t+"</div>"}var i=function(){return{escapeRegExChars:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t}}}(),r={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},c=e.noop;t.utils=i,e.Autocomplete=t,t.defaults={ajaxSettings:{},autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:a,formatGroup:s,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:c,onSearchComplete:c,onSearchError:c,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:n,paramName:"query",transformResult:o,showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1},t.prototype={initialize:function(){var n,o=this,a="."+o.classes.suggestion,s=o.classes.selected,i=o.options;o.element.setAttribute("autocomplete","off"),o.noSuggestionsContainer=e('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),o.suggestionsContainer=t.utils.createNode(i.containerClass),n=e(o.suggestionsContainer),n.appendTo(i.appendTo||"body"),"auto"!==i.width&&n.css("width",i.width),n.on("mouseover.autocomplete",a,function(){o.activate(e(this).data("index"))}),n.on("mouseout.autocomplete",function(){o.selectedIndex=-1,n.children("."+s).removeClass(s)}),n.on("click.autocomplete",a,function(){o.select(e(this).data("index"))}),n.on("click.autocomplete",function(){clearTimeout(o.blurTimeoutId)}),o.fixPositionCapture=function(){o.visible&&o.fixPosition()},e(window).on("resize.autocomplete",o.fixPositionCapture),o.el.on("keydown.autocomplete",function(e){o.onKeyPress(e)}),o.el.on("keyup.autocomplete",function(e){o.onKeyUp(e)}),o.el.on("blur.autocomplete",function(){o.onBlur()}),o.el.on("focus.autocomplete",function(){o.onFocus()}),o.el.on("change.autocomplete",function(e){o.onKeyUp(e)}),o.el.on("input.autocomplete",function(e){o.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition(),e.el.val().length>=e.options.minChars&&e.onValueChange()},onBlur:function(){var t=this,n=t.options,o=t.el.val(),a=t.getQuery(o);t.blurTimeoutId=setTimeout(function(){t.hide(),t.selection&&t.currentValue!==a&&(n.onInvalidateSelection||e.noop).call(t.element)},200)},abortAjax:function(){var e=this;e.currentRequest&&(e.currentRequest.abort(),e.currentRequest=null)},setOptions:function(t){var n=this,o=e.extend({},n.options,t);n.isLocal=Array.isArray(o.lookup),n.isLocal&&(o.lookup=n.verifySuggestionsFormat(o.lookup)),o.orientation=n.validateOrientation(o.orientation,"bottom"),e(n.suggestionsContainer).css({"max-height":o.maxHeight+"px",width:o.width+"px","z-index":o.zIndex}),this.options=o},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,clearTimeout(e.onChangeTimeout),e.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var t=this,n=e(t.suggestionsContainer),o=n.parent().get(0);if(o===document.body||t.options.forceFixPosition){var a=t.options.orientation,s=n.outerHeight(),i=t.el.outerHeight(),r=t.el.offset(),c={top:r.top,left:r.left};if("auto"===a){var l=e(window).height(),u=e(window).scrollTop(),d=-u+r.top-s,p=u+l-(r.top+i+s);a=Math.max(d,p)===d?"top":"bottom"}if(c.top+="top"===a?-s:i,o!==document.body){var h,f=n.css("opacity");t.visible||n.css("opacity",0).show(),h=n.offsetParent().offset(),c.top-=h.top,c.top+=o.scrollTop,c.left-=h.left,t.visible||n.css("opacity",f).hide()}"auto"===t.options.width&&(c.width=t.el.outerWidth()+"px"),n.css(c)}},isCursorAtEnd:function(){var e,t=this,n=t.el.val().length,o=t.element.selectionStart;return"number"==typeof o?o===n:!document.selection||(e=document.selection.createRange(),e.moveStart("character",-n),n===e.text.length)},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===r.DOWN&&t.currentValue)return void t.suggest();if(!t.disabled&&t.visible){switch(e.which){case r.ESC:t.el.val(t.currentValue),t.hide();break;case r.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case r.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex),!1===t.options.tabDisabled)return;break;case r.RETURN:if(-1===t.selectedIndex)return void t.hide();t.select(t.selectedIndex);break;case r.UP:t.moveUp();break;case r.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case r.UP:case r.DOWN:return}clearTimeout(t.onChangeTimeout),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeTimeout=setTimeout(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){if(this.ignoreValueChange)return void(this.ignoreValueChange=!1);var t=this,n=t.options,o=t.el.val(),a=t.getQuery(o);if(t.selection&&t.currentValue!==a&&(t.selection=null,(n.onInvalidateSelection||e.noop).call(t.element)),clearTimeout(t.onChangeTimeout),t.currentValue=o,t.selectedIndex=-1,n.triggerSelectOnValidInput&&t.isExactMatch(a))return void t.select(0);a.length<n.minChars?t.hide():t.getSuggestions(a)},isExactMatch:function(e){var t=this.suggestions;return 1===t.length&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(t){var n,o=this.options.delimiter;return o?(n=t.split(o),e.trim(n[n.length-1])):t},getSuggestionsLocal:function(t){var n,o=this,a=o.options,s=t.toLowerCase(),i=a.lookupFilter,r=parseInt(a.lookupLimit,10);return n={suggestions:e.grep(a.lookup,function(e){return i(e,t,s)})},r&&n.suggestions.length>r&&(n.suggestions=n.suggestions.slice(0,r)),n},getSuggestions:function(t){var n,o,a,s,i=this,r=i.options,c=r.serviceUrl;if(r.params[r.paramName]=t,!1!==r.onSearchStart.call(i.element,r.params)){if(o=r.ignoreParams?null:r.params,e.isFunction(r.lookup))return void r.lookup(t,function(e){i.suggestions=e.suggestions,i.suggest(),r.onSearchComplete.call(i.element,t,e.suggestions)});i.isLocal?n=i.getSuggestionsLocal(t):(e.isFunction(c)&&(c=c.call(i.element,t)),a=c+"?"+e.param(o||{}),n=i.cachedResponse[a]),n&&Array.isArray(n.suggestions)?(i.suggestions=n.suggestions,i.suggest(),r.onSearchComplete.call(i.element,t,n.suggestions)):i.isBadQuery(t)?r.onSearchComplete.call(i.element,t,[]):(i.abortAjax(),s={url:c,data:o,type:r.type,dataType:r.dataType},e.extend(s,r.ajaxSettings),i.currentRequest=e.ajax(s).done(function(e){var n;i.currentRequest=null,n=r.transformResult(e,t),i.processResponse(n,t,a),r.onSearchComplete.call(i.element,t,n.suggestions)}).fail(function(e,n,o){r.onSearchError.call(i.element,t,e,n,o)}))}},isBadQuery:function(e){if(!this.options.preventBadQueries)return!1;for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var t=this,n=e(t.suggestionsContainer);e.isFunction(t.options.onHide)&&t.visible&&t.options.onHide.call(t.element,n),t.visible=!1,t.selectedIndex=-1,clearTimeout(t.onChangeTimeout),e(t.suggestionsContainer).hide(),t.signalHint(null)},suggest:function(){if(!this.suggestions.length)return void(this.options.showNoSuggestionNotice?this.noSuggestions():this.hide());var t,n=this,o=n.options,a=o.groupBy,s=o.formatResult,i=n.getQuery(n.currentValue),r=n.classes.suggestion,c=n.classes.selected,l=e(n.suggestionsContainer),u=e(n.noSuggestionsContainer),d=o.beforeRender,p="",h=function(e,n){var s=e.data[a];return t===s?"":(t=s,o.formatGroup(e,t))};if(o.triggerSelectOnValidInput&&n.isExactMatch(i))return void n.select(0);e.each(n.suggestions,function(e,t){a&&(p+=h(t,0)),p+='<div class="'+r+'" data-index="'+e+'">'+s(t,i,e)+"</div>"}),this.adjustContainerWidth(),u.detach(),l.html(p),e.isFunction(d)&&d.call(n.element,l,n.suggestions),n.fixPosition(),l.show(),o.autoSelectFirst&&(n.selectedIndex=0,l.scrollTop(0),l.children("."+r).first().addClass(c)),n.visible=!0,n.findBestHint()},noSuggestions:function(){var t=this,n=t.options.beforeRender,o=e(t.suggestionsContainer),a=e(t.noSuggestionsContainer);this.adjustContainerWidth(),a.detach(),o.empty(),o.append(a),e.isFunction(n)&&n.call(t.element,o,t.suggestions),t.fixPosition(),o.show(),t.visible=!0},adjustContainerWidth:function(){var t,n=this,o=n.options,a=e(n.suggestionsContainer);"auto"===o.width?(t=n.el.outerWidth(),a.css("width",t>0?t:300)):"flex"===o.width&&a.css("width","")},findBestHint:function(){var t=this,n=t.el.val().toLowerCase(),o=null;n&&(e.each(t.suggestions,function(e,t){var a=0===t.value.toLowerCase().indexOf(n);return a&&(o=t),!a}),t.signalHint(o))},signalHint:function(t){var n="",o=this;t&&(n=o.currentValue+t.value.substr(o.currentValue.length)),o.hintValue!==n&&(o.hintValue=n,o.hint=t,(this.options.onHint||e.noop)(n))},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,function(e){return{value:e,data:null}}):t},validateOrientation:function(t,n){return t=e.trim(t||"").toLowerCase(),-1===e.inArray(t,["auto","bottom","top"])&&(t=n),t},processResponse:function(e,t,n){var o=this,a=o.options;e.suggestions=o.verifySuggestionsFormat(e.suggestions),a.noCache||(o.cachedResponse[n]=e,a.preventBadQueries&&!e.suggestions.length&&o.badQueries.push(t)),t===o.getQuery(o.currentValue)&&(o.suggestions=e.suggestions,o.suggest())},activate:function(t){var n,o=this,a=o.classes.selected,s=e(o.suggestionsContainer),i=s.find("."+o.classes.suggestion);return s.find("."+a).removeClass(a),o.selectedIndex=t,-1!==o.selectedIndex&&i.length>o.selectedIndex?(n=i.get(o.selectedIndex),e(n).addClass(a),n):null},selectHint:function(){var t=this,n=e.inArray(t.hint,t.suggestions);t.select(n)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var t=this;if(-1!==t.selectedIndex)return 0===t.selectedIndex?(e(t.suggestionsContainer).children("."+t.classes.suggestion).first().removeClass(t.classes.selected),t.selectedIndex=-1,t.ignoreValueChange=!1,t.el.val(t.currentValue),void t.findBestHint()):void t.adjustScroll(t.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(t){var n=this,o=n.activate(t);if(o){var a,s,i,r=e(o).outerHeight();a=o.offsetTop,s=e(n.suggestionsContainer).scrollTop(),i=s+n.options.maxHeight-r,a<s?e(n.suggestionsContainer).scrollTop(a):a>i&&e(n.suggestionsContainer).scrollTop(a-n.options.maxHeight+r),n.options.preserveInput||(n.ignoreValueChange=!0,n.el.val(n.getValue(n.suggestions[t].value))),n.signalHint(null)}},onSelect:function(t){var n=this,o=n.options.onSelect,a=n.suggestions[t];n.currentValue=n.getValue(a.value),n.currentValue===n.el.val()||n.options.preserveInput||n.el.val(n.currentValue),n.signalHint(null),n.suggestions=[],n.selection=a,e.isFunction(o)&&o.call(n.element,a)},getValue:function(e){var t,n,o=this,a=o.options.delimiter;return a?(t=o.currentValue,n=t.split(a),1===n.length?e:t.substr(0,t.length-n[n.length-1].length)+e):e},dispose:function(){var t=this;t.el.off(".autocomplete").removeData("autocomplete"),e(window).off("resize.autocomplete",t.fixPositionCapture),e(t.suggestionsContainer).remove()}},e.fn.devbridgeAutocomplete=function(n,o){return arguments.length?this.each(function(){var a=e(this),s=a.data("autocomplete");"string"==typeof n?s&&"function"==typeof s[n]&&s[n](o):(s&&s.dispose&&s.dispose(),s=new t(this,n),a.data("autocomplete",s))}):this.first().data("autocomplete")},e.fn.autocomplete||(e.fn.autocomplete=e.fn.devbridgeAutocomplete)})},function(e,t){e.exports='<p>You are sharing: </p> <p class=project-path></p> <p>&nbsp;</p> <p>Search by name or username.</p> <p>Use "a:" for secondary accounts.</p> <p>&nbsp;</p> <div class=auto-complete-wrapper> <i class="fa fa-circle-o-notch fa-spin loading"></i> <i class="fa fa-exclamation-circle error"></i> <input type=text id=name-search class=form-control name=name placeholder="Start typing to add names..."> </div> <h2>Shared with</h2> <ul id=shared-people></ul>'},function(e,t){e.exports={domain:"https://cernbox.cern.ch",base:"/swanapi/v1",authentication:"/authenticate",shared:"/sharing",shared_with_me:"/shared",share:"/share",clone:"/clone",search:"/search"}}])});
{%- extends "_layout.html" %}

{%- block content %}

            <div class="row">
                <div class="col-lg-12">
                    {{ macros_page.render_breadcrumbs(item) }}

                    <h2>{{ vial_current_view.get_view_title() }}</h2>
                    <hr>
                    <h3>{{ item.name }}</h3>
                    <div class="pull-right">
                        {{ macros_page.render_menu_actions(item) }}

                    </div>
                    <p>
                        <small>
                            <strong>{{ _('Filter created') }}:</strong> {{ babel_format_datetime(item.createtime) }} ({{ _('%(delta)s ago', delta = babel_format_timedelta(current_datetime_utc - item.createtime)) }})
                        </small>
                    </p>
                    <br>

                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active">
                            <a href="#tab-general" aria-controls="tab-general" role="tab" data-toggle="tab">
                                <strong>{{ get_icon('alert-info') }} {{ _('General information') }}</strong>
                            </a>
                        </li>
                        {%- if filter_preview %}
                        <li role="presentation">
                            <a href="#tab-tree" aria-controls="tab-tree" role="tab" data-toggle="tab">
                                <strong>{{ get_icon('structure') }} {{ _('Filter tree structure') }}</strong>
                            </a>
                        </li>
                        {%- endif %}
                        {%- if can_access_endpoint('filters.update', item) %}
                        <li role="presentation">
                            <a href="#tab-changelog" aria-controls="tab-changelog" role="tab" data-toggle="tab">
                                <strong>{{ get_icon('module-changelogs') }} {{ _('Changelogs') }}</strong> <span class="badge">{{ item_changelog | length }}</span>
                            </a>
                        </li>
                        {%- endif %}
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">

                        <div role="tabpanel" class="tab-pane fade in active" id="tab-general">
                            <br>
                            <table class="table table-striped">
                                <tbody>
                                    <tr>
                                        <th>
                                            {{ _('Group') }}:
                                        </th>
                                        <td>
                                            <a data-toggle="tooltip" href="{{ url_for('groups.show', item_id = item.group.id ) }}" title="{{ _('View details of group &quot;%(item)s&quot;', item = item.group.name) }}">
                                                {{ item.group.name }}
                                            </a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('Name') }}:
                                        </th>
                                        <td>
                                            {{ item.name | default(_('<< unknown >>'), True) }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('Type') }}:
                                        </th>
                                        <td>
                                            {{ item.type | default(_('<< unknown >>'), True) }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('Description') }}:
                                        </th>
                                        <td>
                                            {{ item.description | default(_('<< unknown >>'), True) }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('Filter') }}:
                                        </th>
                                        <td>
                                            <code>{{ item.filter | default(_('<< unknown >>'), True) }}</code>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('Hits') }}:
                                        </th>
                                        <td>
                                            <span class="badge">{{ item.hits }}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('Last hit') }}:
                                        </th>
                                        <td>
                                            <span>{% if item.last_hit %}{{ babel_format_datetime(item.last_hit) }}{% else %}---{% endif %}</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            {{ _('State') }}:
                                        </th>
                                        <td>
                                            {{ macros_site.render_label_item_state(item.enabled, True) }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {%- if filter_preview %}
                        <div role="tabpanel" class="tab-pane fade" id="tab-tree">
                            <br>
                            <div class="rule-tree">
                                {{ filter_preview | safe }}
                            </div>
                            <hr>
                            <h4>{{ _('Textual representation') }}:</h4>
<pre>
{{ filter_tree.__str__() }}
</pre>
                        </div>
                        {%- endif %}

                        {%- if can_access_endpoint('filters.update', item) %}
                        <div role="tabpanel" class="tab-pane fade" id="tab-changelog">
                            <br>
                            {%- if item_changelog %}
                            {{ macros_page.render_changelog_records(item_changelog, context_action_menu_changelogs) }}
                            <p>
                                <small>
                                    {{ _('Displaying only latest %(count)s changelogs', count = 100) }}
                                </small>
                            </p>
                            {%- else %}
                            {%- call macros_site.render_alert('info', False) %}
                            {{ _('This object does not have any changelog records at the moment.') }}
                            {%- endcall %}
                            {%- endif %}
                        </div>
                        {%- endif %}

                    </div>

                </div><!-- /.col-lg-12 -->
            </div><!-- /.row -->

    {%- if permission_can('developer') %}

            <hr>

            {{ macros_site.render_raw_item_view(item) }}
            {{ macros_site.render_raw_var('filter_tree',             filter_tree) }}
            {{ macros_site.render_raw_var('filter_compiled',         filter_compiled) }}
            {{ macros_site.render_raw_var('filter_preview',          filter_preview) }}
            {{ macros_site.render_raw_var('filter_compiled_preview', filter_compiled_preview) }}

    {%- endif %}

{%- endblock content %}
